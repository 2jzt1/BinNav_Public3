<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图标缓存调试</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            max-width: 800px; 
            margin: 0 auto;
        }
        .section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
        }
        .success { background: #e8f5e8; }
        .error { background: #ffe8e8; }
        .warning { background: #fff3cd; }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            background: #007cba; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
        }
        button:hover { background: #005a87; }
        .purple { background: #6f42c1; }
        .purple:hover { background: #5a2d91; }
        pre { 
            background: #f5f5f5; 
            padding: 10px; 
            border-radius: 4px; 
            overflow-x: auto; 
            font-size: 12px;
        }
        .icon-test {
            display: inline-block;
            margin: 5px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
        }
        .icon-test img {
            width: 32px;
            height: 32px;
            display: block;
            margin: 0 auto 5px;
        }
    </style>
</head>
<body>
    <h1>🔍 图标缓存调试工具</h1>
    
    <div class="section">
        <h3>1. 快速测试</h3>
        <button onclick="testDomain('github.com')" class="purple">测试 GitHub</button>
        <button onclick="testDomain('google.com')" class="purple">测试 Google</button>
        <button onclick="testDomain('baidu.com')" class="purple">测试 百度</button>
        <button onclick="testCustomDomain()">测试自定义域名</button>
    </div>
    
    <div class="section">
        <h3>2. 图标显示测试</h3>
        <div id="icon-display"></div>
    </div>
    
    <div class="section">
        <h3>3. 调试结果</h3>
        <div id="debug-results"></div>
    </div>

    <script>
        async function testDomain(domain) {
            const resultsDiv = document.getElementById('debug-results');
            const iconDiv = document.getElementById('icon-display');
            
            resultsDiv.innerHTML = `<p>正在测试 ${domain}...</p>`;
            
            try {
                // 测试调试API
                const response = await fetch(`/api/debug-cache?domain=${domain}`);
                const result = await response.json();
                
                // 显示结果
                resultsDiv.innerHTML = `
                    <div class="${result.success ? 'success' : 'error'}">
                        <h4>调试结果 - ${domain}</h4>
                        <p><strong>状态:</strong> ${result.success ? '✅ 成功' : '❌ 失败'}</p>
                        ${result.error ? `<p><strong>错误:</strong> ${result.error}</p>` : ''}
                        <details>
                            <summary>详细信息</summary>
                            <pre>${JSON.stringify(result, null, 2)}</pre>
                        </details>
                    </div>
                `;
                
                // 显示图标
                iconDiv.innerHTML = `
                    <div class="icon-test">
                        <img src="/api/debug-cache?domain=${domain}&returnImage=true" 
                             alt="${domain}" 
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHJ4PSI0IiBmaWxsPSIjZGQzMzMzIi8+PHRleHQgeD0iMTYiIHk9IjIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4/PC90ZXh0Pjwvc3ZnPg=='">
                        <div>缓存图标</div>
                    </div>
                    <div class="icon-test">
                        <img src="https://www.google.com/s2/favicons?domain=${domain}&sz=32" 
                             alt="${domain}"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHJ4PSI0IiBmaWxsPSIjMzM3YWI3Ii8+PHRleHQgeD0iMTYiIHk9IjIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5HPC90ZXh0Pjwvc3ZnPg=='">
                        <div>Google API</div>
                    </div>
                    <div class="icon-test">
                        <img src="/api/cache-icon?domain=${domain}" 
                             alt="${domain}"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHJ4PSI0IiBmaWxsPSIjZmY5NTAwIi8+PHRleHQgeD0iMTYiIHk9IjIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5DPC90ZXh0Pjwvc3ZnPg=='">
                        <div>缓存API</div>
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <h4>测试失败</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        function testCustomDomain() {
            const input = prompt('请输入要测试的域名或URL:', 'example.com');
            if (input) {
                // 如果输入的是URL，提取域名
                let domain = input;
                try {
                    if (input.includes('://')) {
                        domain = new URL(input).hostname;
                    }
                } catch (error) {
                    // 如果解析失败，使用原始值
                }
                testDomain(domain);
            }
        }
        
        // 页面加载时自动测试GitHub
        window.onload = () => {
            testDomain('github.com');
        };
    </script>
</body>
</html>
